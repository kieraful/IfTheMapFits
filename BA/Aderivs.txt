%% 1
%object to image formula
%no transpose
%angles not negated

D_Pt_1 =
 
 n_zpg*sin(phi_bjg) + n_xpg*cos(K_bjg)*cos(phi_bjg) - n_ypg*sin(K_bjg)*cos(phi_bjg)
 n_xpg*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_ypg*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_zpg*cos(phi_bjg)*sin(w_bjg)
 n_xpg*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_ypg*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_zpg*cos(phi_bjg)*cos(w_bjg)
 - n_ypg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + z_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) - n_xpg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - z_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))))
 n_xpg*(x_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - z_sj*(cos(w_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)) + y_sj*(sin(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb))) - n_zpg*(z_sj*(cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - y_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb)*sin(w_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(K_Sb)*sin(phi_Sb)*sin(phi_bjg) - cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg) + sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg))) + n_ypg*(x_sj*(cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - y_sj*(sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_sj*(sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(w_Sb)*sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)))
 n_zpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*(sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg))) - n_ypg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg))) - n_xpg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)))
 x_bjg + y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg)
 y_bjg + y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg)
 z_bjg + x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + x_Sjb*sin(phi_bjg) + z_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_Sjb*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(phi_bjg)*sin(w_bjg)
 1
 n_xpg
 n_ypg
 n_zpg
 - n_xpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_ypg*(y_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(z_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + y_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + y_Sjb*cos(phi_bjg)*cos(w_bjg) + z_Sjb*cos(phi_bjg)*sin(w_bjg))
 n_ypg*(x_sj*(cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + x_Sjb*sin(K_bjg)*sin(phi_bjg) + z_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) + z_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)) + n_zpg*(x_Sjb*cos(phi_bjg) - x_sj*(cos(w_bjg)*sin(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg) + sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_bjg)) + z_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg)) + y_sj*(cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(w_bjg)*sin(phi_bjg)*sin(w_Sb)) - z_Sjb*cos(w_bjg)*sin(phi_bjg) + y_Sjb*sin(phi_bjg)*sin(w_bjg))
 n_xpg*(y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg)) - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg))
 
 
 
//6 Boresight parameters
	A3(0, 0) = n_zpg*sin(phi_bjg) + n_xpg*cos(K_bjg)*cos(phi_bjg) - n_ypg*sin(K_bjg)*cos(phi_bjg);

	A3(0, 1) = n_xpg*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_ypg*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_zpg*cos(phi_bjg)*sin(w_bjg);

	A3(0, 2) = n_xpg*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_ypg*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_zpg*cos(phi_bjg)*cos(w_bjg);
	
	A3(0, 3) = -1.0*n_ypg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + z_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) - n_xpg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - z_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))));

	A3(0, 4) = n_xpg*(x_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - z_sj*(cos(w_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)) + y_sj*(sin(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb))) - n_zpg*(z_sj*(cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - y_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb)*sin(w_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(K_Sb)*sin(phi_Sb)*sin(phi_bjg) - cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg) + sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg))) + n_ypg*(x_sj*(cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - y_sj*(sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_sj*(sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(w_Sb)*sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)));

	A3(0, 5) = n_zpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*(sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg))) - n_ypg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg))) - n_xpg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)));


	//4 Plane parameters
	int i = 6 + 4 * planeNum;

	A3(0, i) = x_bjg + y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg);

	A3(0, i + 1) = y_bjg + y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg);

	A3(0, i + 2) = z_bjg + x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + x_Sjb*sin(phi_bjg) + z_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_Sjb*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(phi_bjg)*sin(w_bjg);

	A3(0, i + 3) = 1;

	
	//6 scan parameters
	int j = 6 + 4 * numPlanes + 6 * scanNum;

	A3(0, j) = n_xpg;

	A3(0, j + 1) = n_ypg;

	A3(0, j + 2) = n_zpg;

	A3(0, j + 3) = -1.0*n_xpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_ypg*(y_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(z_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + y_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + y_Sjb*cos(phi_bjg)*cos(w_bjg) + z_Sjb*cos(phi_bjg)*sin(w_bjg));

	A3(0, j + 4) = n_ypg*(x_sj*(cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + x_Sjb*sin(K_bjg)*sin(phi_bjg) + z_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) + z_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)) + n_zpg*(x_Sjb*cos(phi_bjg) - x_sj*(cos(w_bjg)*sin(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg) + sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_bjg)) + z_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg)) + y_sj*(cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(w_bjg)*sin(phi_bjg)*sin(w_Sb)) - z_Sjb*cos(w_bjg)*sin(phi_bjg) + y_Sjb*sin(phi_bjg)*sin(w_bjg));

	A3(0, j + 5) = n_xpg*(y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg)) - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg));


	
	
	


%% 2
%object to image formula
%no transpose
%angles negated


 
A3(0, 0) = n_xpg*cos(K_bjg)*cos(phi_bjg) - n_zpg*sin(phi_bjg) + n_ypg*sin(K_bjg)*cos(phi_bjg);
A3(0, 1) = n_ypg*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_xpg*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_zpg*cos(phi_bjg)*sin(w_bjg);
A3(0, 2) = n_xpg*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - n_ypg*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_zpg*cos(phi_bjg)*cos(w_bjg);
A3(0, 3) = n_xpg*(y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + z_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) - n_ypg*(y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - z_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))));
A3(0, 4) = n_ypg*(y_sj*(sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) - x_sj*(sin(K_Sb)*sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) + z_sj*(cos(w_Sb)*sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb))) - n_zpg*(z_sj*(cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + y_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb)*sin(w_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg) - cos(K_Sb)*sin(phi_Sb)*sin(phi_bjg) + sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg))) - n_xpg*(x_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) + z_sj*(cos(w_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)) + y_sj*(sin(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)));
A3(0, 5) = n_ypg*(z_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg))) - n_xpg*(z_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg))) + n_zpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) - z_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)));
int i = 6 + 4 * planeNum;

A3(0, i) = x_bjg - y_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg);
A3(0, i+1) = y_bjg + y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*sin(K_bjg)*cos(phi_bjg)
A3(0, i+2) = z_bjg - x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - x_Sjb*sin(phi_bjg) - z_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + y_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_Sjb*cos(phi_bjg)*cos(w_bjg) + y_Sjb*cos(phi_bjg)*sin(w_bjg);
A3(0, i+3) = 1
int j = 6 + 4 * numPlanes + 6 * scanNum;

A3(0, j) = n_xpg;
A3(0, j+1) = n_ypg;
A3(0, j+2) = n_zpg;
A3(0, j+3) = n_xpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + z_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_ypg*(y_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + z_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) + n_zpg*(y_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) - z_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + y_Sjb*cos(phi_bjg)*cos(w_bjg) - z_Sjb*cos(phi_bjg)*sin(w_bjg));
A3(0, j+4) = n_ypg*(y_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) - x_sj*(cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - z_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - x_Sjb*sin(K_bjg)*sin(phi_bjg) + z_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg) + y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) - z_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_zpg*(x_Sjb*cos(phi_bjg) + x_sj*(cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg) - cos(w_bjg)*sin(phi_Sb)*sin(phi_bjg) + sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_bjg)) + z_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg)) + y_sj*(sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(w_bjg)*sin(phi_bjg)*sin(w_Sb)) + z_Sjb*cos(w_bjg)*sin(phi_bjg) + y_Sjb*sin(phi_bjg)*sin(w_bjg));
A3(0, j+5) = - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*cos(K_bjg)*cos(phi_bjg)) - n_xpg*(y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*sin(K_bjg)*cos(phi_bjg));
 
 
 



%% 3
%object to image formula
%with transpose
%angles not negated


D_Pt_3 =
 
A3(0, 0) = n_ypg*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_zpg*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_xpg*cos(K_bjg)*cos(phi_bjg);
A3(0, 1) = n_ypg*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_zpg*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - n_xpg*sin(K_bjg)*cos(phi_bjg);
A3(0, 2) = n_xpg*sin(phi_bjg) + n_zpg*cos(phi_bjg)*cos(w_bjg) - n_ypg*cos(phi_bjg)*sin(w_bjg);
A3(0, 3) = n_xpg*(x_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb))) - n_ypg*(x_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg))) - n_zpg*(x_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)));
A3(0, 4) = n_zpg*(z_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb)) - x_sj*(cos(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + y_sj*(sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg))) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb) + cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_sj*(cos(w_Sb)*sin(phi_Sb)*sin(phi_bjg) - cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)*sin(w_Sb)) - y_sj*(cos(K_bjg)*sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb))) + n_ypg*(x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - y_sj*(sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + z_sj*(cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*cos(w_Sb)*sin(phi_Sb)*sin(w_bjg)));
A3(0, 5) = - n_ypg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)))) - n_xpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + x_sj*(sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg))) - n_zpg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))));
int i = 6 + 4 * planeNum;

A3(0, i) = x_bjg + x_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*(cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb) + cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_Sjb*sin(phi_bjg) + x_Sjb*cos(K_bjg)*cos(phi_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg);
A3(0, i+1) = y_bjg + x_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - z_Sjb*cos(phi_bjg)*sin(w_bjg);
A3(0, i+2) = z_bjg + x_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + y_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + z_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_Sjb*cos(phi_bjg)*cos(w_bjg);
A3(0, i+3) = 1;
int j = 6 + 4 * numPlanes + 6 * scanNum;
A3(0, j) = n_xpg;
A3(0, j+1) = n_ypg;
A3(0, j+2) = n_zpg;
A3(0, j+3) = n_zpg*(x_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - z_Sjb*cos(phi_bjg)*sin(w_bjg)) - n_ypg*(x_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + y_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + z_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_Sjb*cos(phi_bjg)*cos(w_bjg));
A3(0, j+4) = n_xpg*(x_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg)) + y_sj*(cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)) + z_Sjb*cos(phi_bjg) - z_sj*(cos(K_bjg)*sin(phi_Sb)*sin(phi_bjg) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb) + sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb)) - x_Sjb*cos(K_bjg)*sin(phi_bjg) + y_Sjb*sin(K_bjg)*sin(phi_bjg)) - n_zpg*(z_sj*(cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_sj*(cos(w_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(w_bjg)*sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + z_Sjb*cos(w_bjg)*sin(phi_bjg) + x_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)) + n_ypg*(z_sj*(cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) + cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg)*sin(w_bjg) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + x_sj*(sin(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_Sjb*sin(phi_bjg)*sin(w_bjg) + x_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg));
A3(0, j+5) = - n_xpg*(z_sj*(sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb) - cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + x_sj*(cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + y_sj*(cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + y_Sjb*cos(K_bjg)*cos(phi_bjg) + x_Sjb*sin(K_bjg)*cos(phi_bjg)) - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - x_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)))) - n_zpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))));




%% 4
%object to image formula
%with transpose
%angles negated


D_Pt_4 =
 
A3(0, 0) = n_zpg*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - n_ypg*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_xpg*cos(K_bjg)*cos(phi_bjg);
A3(0, 1) = n_ypg*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_zpg*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_xpg*sin(K_bjg)*cos(phi_bjg);
A3(0, 2) = n_zpg*cos(phi_bjg)*cos(w_bjg) - n_xpg*sin(phi_bjg) + n_ypg*cos(phi_bjg)*sin(w_bjg);
A3(0, 3) = n_ypg*(x_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) - y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg))) - n_zpg*(x_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) - y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) + n_xpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + z_sj*(cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)));
A3(0, 4) = n_ypg*(y_sj*(sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + x_sj*(cos(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - z_sj*(sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*cos(w_Sb)*sin(phi_Sb)*sin(w_bjg))) - n_zpg*(x_sj*(cos(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb)) + y_sj*(sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg))) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb) + cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) - cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_sj*(cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg) - cos(w_Sb)*sin(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)*sin(w_Sb)) + y_sj*(cos(K_bjg)*sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)));
A3(0, 5) = n_zpg*(y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)))) - n_xpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + x_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg))) - n_ypg*(y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))));
int i = 6 + 4 * planeNum;
A3(0, i+1) = x_bjg - x_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + y_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*(cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb) + cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) - z_Sjb*sin(phi_bjg) + x_Sjb*cos(K_bjg)*cos(phi_bjg) + y_Sjb*sin(K_bjg)*cos(phi_bjg);
A3(0, i+2) = y_bjg - x_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + z_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + z_Sjb*cos(phi_bjg)*sin(w_bjg);
A3(0, i+3) = z_bjg + x_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - y_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_Sjb*cos(phi_bjg)*cos(w_bjg);
A3(0, i+4) = 1;
int j = 6 + 4 * numPlanes + 6 * scanNum;
A3(0, j) = n_xpg;
A3(0, j+1) = n_ypg;
A3(0, j+2) = n_zpg;
A3(0, j+3) = n_ypg*(x_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - y_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_Sjb*cos(phi_bjg)*cos(w_bjg)) + n_zpg*(x_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + y_sj*(sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - z_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - z_Sjb*cos(phi_bjg)*sin(w_bjg));
A3(0, j+4) = n_ypg*(y_sj*(sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - z_sj*(cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) + cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg)*sin(w_bjg) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) - x_sj*(sin(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - z_Sjb*sin(phi_bjg)*sin(w_bjg) + x_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg) + y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_zpg*(z_sj*(cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_sj*(cos(w_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) - y_sj*(cos(w_bjg)*sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + z_Sjb*cos(w_bjg)*sin(phi_bjg) - x_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)) - n_xpg*(x_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg)) + y_sj*(sin(K_bjg)*sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)) + z_Sjb*cos(phi_bjg) + z_sj*(cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb) - cos(K_bjg)*sin(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) + y_Sjb*sin(K_bjg)*sin(phi_bjg));
A3(0, j+5) = n_xpg*(z_sj*(sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) - x_sj*(cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + y_sj*(cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + y_Sjb*cos(K_bjg)*cos(phi_bjg) - x_Sjb*sin(K_bjg)*cos(phi_bjg)) - n_ypg*(x_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)))) + n_zpg*(x_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))));
 




%% 5
%image to object formula
%no transpose
%angles not negated

D_Pt_5 =
 
A3(0, 0) = n_zpg*sin(phi_bjg) + n_xpg*cos(K_bjg)*cos(phi_bjg) - n_ypg*sin(K_bjg)*cos(phi_bjg);
A3(0, 1) = n_xpg*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_ypg*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_zpg*cos(phi_bjg)*sin(w_bjg);
A3(0, 2) = n_xpg*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_ypg*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_zpg*cos(phi_bjg)*cos(w_bjg);
A3(0, 3) = - n_ypg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + z_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) - n_xpg*(y_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - z_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))));
A3(0, 4) = n_xpg*(x_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - z_sj*(cos(w_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)) + y_sj*(sin(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb))) - n_zpg*(z_sj*(cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) - y_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb)*sin(w_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(K_Sb)*sin(phi_Sb)*sin(phi_bjg) - cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg) + sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg))) + n_ypg*(x_sj*(cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) - y_sj*(sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) + z_sj*(sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(w_Sb)*sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)));
A3(0, 5) = n_zpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - x_sj*(sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg))) - n_ypg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg))) - n_xpg*(y_sj*((sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + z_sj*((sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)));
int i = 6 + 4 * planeNum;
A3(0, i) = x_bjg + y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg);
A3(0, i+1) = y_bjg + y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg);
A3(0, i+2) = z_bjg + x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + x_Sjb*sin(phi_bjg) + z_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_Sjb*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(phi_bjg)*sin(w_bjg);
A3(0, i+3) = 1;
int j = 6 + 4 * numPlanes + 6 * scanNum;
A3(0, j) = n_xpg;
A3(0, j+1) = n_ypg;
A3(0, j+2) = n_zpg;
A3(0, j+3) = - n_xpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_ypg*(y_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - z_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(z_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + y_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + y_Sjb*cos(phi_bjg)*cos(w_bjg) + z_Sjb*cos(phi_bjg)*sin(w_bjg));
A3(0, j+4) = n_ypg*(x_sj*(cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - y_sj*(sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + x_Sjb*sin(K_bjg)*sin(phi_bjg) + z_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) + z_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)) + n_zpg*(x_Sjb*cos(phi_bjg) - x_sj*(cos(w_bjg)*sin(phi_Sb)*sin(phi_bjg) - cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg) + sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_bjg)) + z_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg)) + y_sj*(cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(w_bjg)*sin(phi_bjg)*sin(w_Sb)) - z_Sjb*cos(w_bjg)*sin(phi_bjg) + y_Sjb*sin(phi_bjg)*sin(w_bjg));
A3(0, j+5) = n_xpg*(y_Sjb*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) - sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) + sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*sin(K_bjg)*cos(phi_bjg)) - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) + sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) - cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) - sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) + cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) + cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) - cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg));
 



%% 6
%image to object formula
%no transpose
%angles negated

D_Pt_6 =
 
A3(0, 0) = n_xpg*cos(K_bjg)*cos(phi_bjg) - n_zpg*sin(phi_bjg) + n_ypg*sin(K_bjg)*cos(phi_bjg);
A3(0, 1) = n_ypg*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - n_xpg*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + n_zpg*cos(phi_bjg)*sin(w_bjg);
A3(0, 2) = n_xpg*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - n_ypg*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + n_zpg*cos(phi_bjg)*cos(w_bjg);
A3(0, 3) = n_xpg*(y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + z_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_zpg*(y_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + z_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb))) - n_ypg*(y_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - z_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))));
A3(0, 4) = n_ypg*(y_sj*(sin(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)) - x_sj*(sin(K_Sb)*sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) + z_sj*(cos(w_Sb)*sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb))) - n_zpg*(z_sj*(cos(K_Sb)*cos(phi_Sb)*cos(w_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + y_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_Sb) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb)*sin(w_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg) - cos(K_Sb)*sin(phi_Sb)*sin(phi_bjg) + sin(K_Sb)*cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg))) - n_xpg*(x_sj*(cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - sin(K_Sb)*sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*cos(K_bjg)*cos(phi_bjg)*sin(phi_Sb)) + z_sj*(cos(w_Sb)*sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)) + y_sj*(sin(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)));
A3(0, 5) = n_ypg*(z_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + sin(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg))) - n_xpg*(z_sj*((sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))) - y_sj*((sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_bjg)*cos(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))) + x_sj*(cos(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg))) + n_zpg*(y_sj*(sin(phi_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb))) - z_sj*(sin(phi_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_bjg)*sin(w_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb))) + x_sj*(sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)));
int i = 6 + 4 * planeNum;
A3(0, i) = x_bjg - y_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + z_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) + z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*cos(K_bjg)*cos(phi_bjg);
A3(0, i+1) = y_bjg + y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*sin(K_bjg)*cos(phi_bjg);
A3(0, i+2) = z_bjg - x_sj*(cos(K_Sb)*cos(phi_Sb)*sin(phi_bjg) + cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - x_Sjb*sin(phi_bjg) - z_sj*(sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) + y_sj*(sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + z_Sjb*cos(phi_bjg)*cos(w_bjg) + y_Sjb*cos(phi_bjg)*sin(w_bjg);
A3(0, i+3) = 1;
int j = 6 + 4 * numPlanes + 6 * scanNum;
A3(0, j) = n_xpg;
A3(0, j+1) = n_ypg;
A3(0, j+2) = n_zpg;
A3(0, j+3) = n_xpg*(y_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + z_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) - n_ypg*(y_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + z_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) - cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg))) - x_sj*(sin(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)))) + n_zpg*(y_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*cos(phi_bjg)*sin(w_Sb)*sin(w_bjg)) - z_sj*(cos(phi_bjg)*cos(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*sin(w_bjg)) + x_sj*(cos(phi_bjg)*sin(phi_Sb)*sin(w_bjg) + sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)) + y_Sjb*cos(phi_bjg)*cos(w_bjg) - z_Sjb*cos(phi_bjg)*sin(w_bjg));
A3(0, j+4) = n_ypg*(y_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) - x_sj*(cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + sin(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - sin(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) - z_sj*(sin(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - x_Sjb*sin(K_bjg)*sin(phi_bjg) + z_Sjb*sin(K_bjg)*cos(phi_bjg)*cos(w_bjg) + y_Sjb*sin(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_xpg*(x_sj*(cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*sin(phi_bjg) + cos(K_bjg)*cos(phi_bjg)*cos(w_bjg)*sin(phi_Sb) - cos(K_bjg)*sin(K_Sb)*cos(phi_Sb)*cos(phi_bjg)*sin(w_bjg)) + z_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_Sb)*cos(w_bjg)) - y_sj*(cos(K_bjg)*sin(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)*cos(w_bjg)*sin(w_Sb)) + x_Sjb*cos(K_bjg)*sin(phi_bjg) - z_Sjb*cos(K_bjg)*cos(phi_bjg)*cos(w_bjg) - y_Sjb*cos(K_bjg)*cos(phi_bjg)*sin(w_bjg)) - n_zpg*(x_Sjb*cos(phi_bjg) + x_sj*(cos(K_Sb)*cos(phi_Sb)*cos(phi_bjg) - cos(w_bjg)*sin(phi_Sb)*sin(phi_bjg) + sin(K_Sb)*cos(phi_Sb)*sin(phi_bjg)*sin(w_bjg)) + z_sj*(cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) - sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*cos(w_bjg)*sin(phi_bjg)) + y_sj*(sin(phi_bjg)*sin(w_bjg)*(cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) + cos(phi_Sb)*cos(w_bjg)*sin(phi_bjg)*sin(w_Sb)) + z_Sjb*cos(w_bjg)*sin(phi_bjg) + y_Sjb*sin(phi_bjg)*sin(w_bjg));
A3(0, j+5) = - n_ypg*(y_Sjb*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - cos(K_Sb)*cos(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + y_sj*((cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(sin(K_bjg)*cos(w_bjg) - cos(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - cos(phi_Sb)*sin(w_Sb)*(sin(K_bjg)*sin(w_bjg) + cos(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - x_Sjb*cos(K_bjg)*cos(phi_bjg)) - n_xpg*(y_Sjb*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - z_Sjb*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + x_sj*(sin(phi_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg)) + sin(K_Sb)*cos(phi_Sb)*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(K_Sb)*sin(K_bjg)*cos(phi_Sb)*cos(phi_bjg)) - z_sj*((cos(K_Sb)*sin(w_Sb) - sin(K_Sb)*cos(w_Sb)*sin(phi_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) - sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*sin(w_Sb) + cos(K_Sb)*cos(w_Sb)*sin(phi_Sb)) + cos(phi_Sb)*cos(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) - y_sj*(sin(K_bjg)*cos(phi_bjg)*(sin(K_Sb)*cos(w_Sb) - cos(K_Sb)*sin(phi_Sb)*sin(w_Sb)) - (cos(K_Sb)*cos(w_Sb) + sin(K_Sb)*sin(phi_Sb)*sin(w_Sb))*(cos(K_bjg)*cos(w_bjg) + sin(K_bjg)*sin(phi_bjg)*sin(w_bjg)) + cos(phi_Sb)*sin(w_Sb)*(cos(K_bjg)*sin(w_bjg) - sin(K_bjg)*cos(w_bjg)*sin(phi_bjg))) + x_Sjb*sin(K_bjg)*cos(phi_bjg));
 
 
 
 
 
 
 
 
 %% Two step derivatives (need to update associated functions to use diff rotation formulas
 	//MatrixXd B_PtWrtRot = PtEqnWrtRotSb(w_bjg, phi_bjg, K_bjg, x_sj, y_sj, z_sj, n_xpg, n_ypg, n_zpg);

	//MatrixXd B_RotWrtAng = RotWrtAngles(w_Sb, phi_Sb, K_Sb);

	//A3.block(0, 3, 1, 3) = B_PtWrtRot.transposeInPlace()*B_RotWrtAng;

	//B_PtWrtRot.resize(0, 0);
	//B_RotWrtAng.resize(0, 0);
	
	//MatrixXd S_PtWrtRot = PtEqnWrtRotbjg(x_Sjb, y_Sjb, z_Sjb, w_Sb, phi_Sb, K_Sb, x_sj, y_sj, z_sj, n_xpg, n_ypg, n_zpg);

	//MatrixXd S_RotWrtAng = RotWrtAngles(w_bjg, phi_bjg, K_bjg);                               

	//A3.block(0, j + 3, 1, 3) = S_PtWrtRot.transposeInPlace()*S_RotWrtAng;

	//S_PtWrtRot.resize(0, 0);
	//S_RotWrtAng.resize(0, 0);
 